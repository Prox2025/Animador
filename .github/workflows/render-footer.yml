name: Processar Vídeo com Transparência

on:
  workflow_dispatch:

jobs:
  video_pipeline:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v3

      - name: Instalar Node.js + Puppeteer
        run: |
          sudo apt update
          sudo apt install -y nodejs npm
          npm install puppeteer

      - name: Instalar Python, FFmpeg e dependências
        run: |
          sudo apt install -y ffmpeg python3-opencv python3-pip
          pip install numpy

      - name: Baixar vídeo do servidor com Puppeteer
        run: node baixar_com_puppeteer.js

      - name: Remover fundo e gerar vídeos com transparência
        run: python3 remover_fundo.py

      - name: Upload do MP4 com alpha
        uses: actions/upload-artifact@v3
        with:
          name: video-alpha-prores-mp4
          path: saida/video_sem_fundo.mp4

      - name: Upload do WebM com alpha
        uses: actions/upload-artifact@v3
        with:
          name: video-alpha-webm
          path: saida/video_sem_fundo.webm
